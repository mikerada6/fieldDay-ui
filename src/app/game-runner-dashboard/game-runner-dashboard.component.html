<div class="dashboard-wrapper">
  <header class="dashboard-header">
    <h1>{{ game?.name || 'Game Runner Dashboard' }}</h1>
    <p *ngIf="game && game.objective">{{ game.objective }}</p>
    <button *ngIf="!loading && game" class="instructions-btn" (click)="toggleInstructionsModal()">View Instructions</button>
  </header>

  <!-- Loading Screen -->
  <div *ngIf="loading" class="loading-screen">
    <p>Loading dashboard data...</p>
  </div>

  <!-- Error Screen -->
  <div *ngIf="!loading && errorMessage" class="error-screen">
    <p>Error: {{ errorMessage }}</p>
    <button (click)="loadDashboardData()">Retry</button>
  </div>

  <!-- Main Dashboard Content -->
  <div *ngIf="!loading && !errorMessage" class="dashboard-content">
    <!-- Game Details Section -->
    <section class="game-details" *ngIf="game">
      <div class="game-details-header">
        <h2>Game Information</h2>
        <p class="game-name">{{ game.name }}</p>
      </div>
      <div class="game-info-content">
        <p><span class="icon">🎮</span> <strong>Type:</strong> {{ game.type | titlecase }}</p>
        <p><span class="icon">📍</span> <strong>Location:</strong> {{ game.location }}</p>
        <p><span class="icon">🛠️</span> <strong>Equipment:</strong> {{ game.equipment }}</p>
        <p><span class="icon">👥</span> <strong>Team Members:</strong> {{ game.numberOfTeamMembers }}</p>
      </div>
    </section>

    <!-- Teams List Section -->
    <section class="teams-list" *ngIf="teams && teams.length">
      <h2>Teams</h2>
      <div class="teams-container">
        <div class="team-card" *ngFor="let team of teams">
          <div class="team-header">
            <div class="team-flag">
              <img [src]="team.flagUrl" [alt]="team.name + ' flag'" />
            </div>
            <div class="team-name-section">
              <h3>{{ team.name }}</h3>
              <p>
                <span class="icon">⭐</span>
                Score:
                {{ game?.type === 'time' ? formatTime(team.score) : (team.score || 0) }}
              </p>
            </div>
          </div>
          <div class="team-details">
            <p><span class="icon">👤</span> <strong>Captain:</strong> {{ team.teamCaptain }}</p>
            <p><span class="icon">👨‍🏫</span> <strong>Teacher:</strong> {{ team.teamChaperon }}</p>
            <div class="team-score">
              <button class="edit-btn" (click)="openEditScore(team)">Edit Score</button>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- Instructions Modal -->
  <div class="instructions-modal" *ngIf="showInstructionsModal">
    <div class="modal-content">
      <h2>Game Instructions</h2>
      <p>{{ game?.instructions || 'No instructions available.' }}</p>
      <button (click)="toggleInstructionsModal()">Close</button>
    </div>
  </div>

  <!-- Edit Score Modal -->
  <div class="score-edit-modal" *ngIf="editScoreModalOpen">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Edit Score for {{ selectedTeam?.name }}</h2>
        <button class="close-btn" (click)="closeEditScore()">&times;</button>
      </div>
      <div class="modal-body">
        <!-- For Point-Based Game -->
        <div *ngIf="game?.type === 'point'" class="score-input-group">
          <label for="editScoreValue">Points:</label>
          <input id="editScoreValue" type="number" [(ngModel)]="editScoreValue" name="editScoreValue" />
        </div>
        <!-- For Time-Based Game -->
        <div *ngIf="game?.type === 'time'" class="score-input-group">
          <label for="editMinutes">Minutes:</label>
          <input id="editMinutes" type="number" [(ngModel)]="editMinutes" name="editMinutes" />
          <label for="editSeconds">Seconds:</label>
          <input id="editSeconds" type="number" [(ngModel)]="editSeconds" name="editSeconds" />
          <label for="editMilliseconds">Milliseconds:</label>
          <input id="editMilliseconds" type="number" [(ngModel)]="editMilliseconds" name="editMilliseconds" />
        </div>
      </div>
      <div class="modal-actions">
        <button class="save-btn" (click)="submitScoreUpdate()">Save</button>
        <button class="cancel-btn" (click)="closeEditScore()">Cancel</button>
      </div>
    </div>
  </div>
</div>
